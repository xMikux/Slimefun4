name: Create new Release Candidate

on:
  workflow_dispatch:
    inputs:
      number:
        description: 'RC number (e.g. 15)'
        required: true
      release_date:
        description: 'Date of release (e.g. 12-apr-2021)'
        required: true

jobs:
  release:

    name: Create new release
    runs-on: ubuntu-latest

    steps:

    - name: Checkout repository
      uses: actions/checkout@v2
      with:
        ref: 'stable'

    - name: Merge latest commits into 'stable'
      uses: devmasx/merge-branch@1.4.0
      with:
        type: now
        from_branch: 'master'
        target_branch: 'stable'
        github_token: ${{ secrets.GITHUB_TOKEN }}

    - name: Get the latest commit sha
      id: latest
      run: echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"

    - name: Create Release
      id: create_release
      uses: actions/create-release@v1.1.4
      env:
        GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
      with:
        tag_name: RC-${{ github.event.inputs.number }}
        release_name: éå®˜æ–¹ç©©å®šç‰ˆ ${{ github.event.inputs.number }} (git ${{ steps.latest.outputs.sha_short }})
        draft: false
        prerelease: false
        body: |
          ## ğŸ’¾  ä¸‹è¼‰é€£çµ
          Slimefun4çš„ç©©å®šç‰ˆæœ¬å¯ä»¥åœ¨é€™è£¡ä¸‹è¼‰:

          **å®˜æ–¹è‹±æ–‡ç‰ˆ**
          https://thebusybiscuit.github.io/builds/TheBusyBiscuit/Slimefun4/stable/Slimefun4-${{ github.event.inputs.number }}.jar

          **éå®˜æ–¹ç¹é«”ä¸­æ–‡ç‰ˆ**
          å°šæœªæ”¯æŒ å¦‚æœæœ‰éœ€è¦å¯åœ¨éå®˜æ–¹Discordå…§é€²è¡Œå»ºè­°!

          ### â“ å¦‚ä½•å®‰è£Slimefun
          åªéœ€å°‡ Slimefun4 jaræª”æ¡ˆæ‹–æ”¾è‡³ä¼ºæœå™¨çš„ `/plugins/` è³‡æ–™å¤¾ä¸­.
          å¦‚æœä½ éœ€è¦å®‰è£ Slimefun æ™‚éœ€è¦ä»»ä½•å¹«åŠ©, è«‹éš¨æ™‚æŸ¥çœ‹æˆ‘å€‘çš„ wiki æ–‡ç« åœ¨ [å¦‚ä½•å®‰è£Slimefun](https://github.com/xMikux/Slimefun4/wiki/Installing-Slimefun).

          ## ğŸ“ æ›´æ–°æ—¥èªŒ
          ä½ å¯ä»¥åœ¨é€™è£¡æ‰¾åˆ°é€™å€‹ç‰ˆæœ¬ä¸­åŒ…å«çš„æ‰€æœ‰è®ŠåŒ–çš„ç°¡çŸ­æ‘˜è¦(å®˜æ–¹è‹±æ–‡ç‰ˆ):
          https://github.com/Slimefun/Slimefun4/blob/master/CHANGELOG.md#release-candidate-${{ github.event.inputs.number }}-${{ github.event.inputs.release_date }}

          ## ğŸ“¦  Maven dependency reference
          If you want to develop an addon for Slimefun ([Developer Reference](https://github.com/Slimefun/Slimefun4/wiki/Developer-Guide)), then you can build your project against this specific version of Slimefun using the following `pom.xml` dependency:
          ```xml
          <repositories>
            <repository>
              <id>jitpack.io</id>
              <url>https://jitpack.io</url>
            </repository>
          </repositories>

          <dependencies>
            <dependency>
              <groupId>com.github.Slimefun</groupId>
              <artifactId>Slimefun4</artifactId>
              <version>RC-${{ github.event.inputs.number }}</version>
            </dependency>
          </dependencies>
          ```
